<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RunSmart Training Planner</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
  </head>
  <body>
    <!-- Sidebar navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">RunSmart</div>
        <button class="sidebar-close" id="sidebar-close" aria-label="Close menu">&times;</button>
      </div>
      <nav class="sidebar-nav">
        <a href="#dashboard" class="sidebar-link active" data-section="dashboard">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          <span data-i18n="sidebar.dashboard">Dashboard</span>
        </a>
        <a href="#planning" class="sidebar-link" data-section="planning">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
          <span data-i18n="sidebar.planning">Planning</span>
        </a>
        <a href="#insights" class="sidebar-link" data-section="insights">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
          <span data-i18n="sidebar.insights">Insights</span>
        </a>
        <a href="#data" class="sidebar-link" data-section="data">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>
          <span data-i18n="sidebar.data">Data</span>
        </a>
        <a href="#coach" class="sidebar-link" data-section="coach">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v1a7 7 0 0 1-14 0v-1"/><line x1="12" y1="18" x2="12" y2="22"/></svg>
          <span data-i18n="sidebar.coach">Coach</span>
        </a>
        <a href="#roadmap" class="sidebar-link" data-section="roadmap">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
          <span data-i18n="sidebar.roadmap">Roadmap</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <div class="lang-switcher">
          <button class="lang-option active" data-lang="en">EN</button>
          <button class="lang-option" data-lang="no">NO</button>
        </div>
        <div class="sidebar-auth">
          <span class="user-email" id="user-email" hidden></span>
          <button class="sidebar-auth-btn" data-action="signin" id="signin-btn" data-i18n="nav.signin">Sign in</button>
          <button class="sidebar-auth-btn" data-action="signout" id="signout-btn" hidden data-i18n="nav.signout">Sign out</button>
        </div>
      </div>
    </aside>

    <!-- Sidebar overlay for mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Main content area -->
    <div class="main-wrapper">
      <!-- Top bar (mobile) -->
      <header class="topbar">
        <button class="topbar-menu" id="topbar-menu" aria-label="Open navigation">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <div class="topbar-logo">RunSmart</div>
        <button class="topbar-cta" data-action="start-plan" data-i18n="nav.startPlan">Start Plan</button>
      </header>

      <!-- Dashboard section -->
      <section id="dashboard" class="page active">
        <div class="page-header">
          <div>
            <p class="eyebrow" data-i18n="hero.eyebrow">AI-guided endurance training</p>
            <h1 data-i18n="hero.title">Plan smarter, adapt faster, and train with clarity.</h1>
            <p class="subhead" data-i18n="hero.subhead">
              RunSmart blends evidence-informed coaching with real-life constraints so every training block
              feels achievable, personalized, and explainable.
            </p>
          </div>
        </div>
        <div class="dashboard-grid">
          <div class="hero-card" id="hero-card">
            <div id="hero-card-static">
              <h3 data-i18n="hero.nextGoal">Next Goal Race</h3>
              <p class="muted" data-i18n="hero.trailInfo">Trail 50K &bull; 18 weeks out</p>
              <div class="card-grid">
                <div>
                  <span class="label" data-i18n="hero.weeklyFocus">Weekly focus</span>
                  <strong>Base 2</strong>
                </div>
                <div>
                  <span class="label" data-i18n="hero.mileage">Mileage</span>
                  <strong>42&ndash;48 mi</strong>
                </div>
                <div>
                  <span class="label" data-i18n="hero.keyWorkout">Key workout</span>
                  <strong>Progression long run</strong>
                </div>
                <div>
                  <span class="label" data-i18n="hero.readiness">Readiness</span>
                  <strong class="positive" data-i18n="hero.onTrack">On track</strong>
                </div>
              </div>
              <p class="card-note" data-i18n="hero.cardNote">
                &ldquo;You handled last week well. Keep the mid-week intensity controlled to stay fresh for the long run.&rdquo;
              </p>
            </div>
            <div id="hero-card-dynamic" hidden></div>
          </div>
          <div class="dashboard-actions">
            <button class="cta" data-action="generate-plan" data-i18n="hero.generatePlan">Generate a plan</button>
            <button class="ghost" data-action="sample-week" data-i18n="hero.sampleWeek">View sample week</button>
          </div>
        </div>
      </section>

      <!-- Planning section -->
      <section id="planning" class="page">
        <div class="page-header">
          <h2 data-i18n="planning.title">Training plan generator</h2>
          <p data-i18n="planning.desc">
            Build goal-oriented blocks with progression guardrails, realistic scheduling, and transparent coaching
            rationale.
          </p>
        </div>
        <div class="planning-grid">
          <div class="grid">
            <article>
              <h4 data-i18n="planning.macroBlock">Macro block builder</h4>
              <p data-i18n="planning.macroBlockDesc">Base &rarr; Build &rarr; Peak &rarr; Taper sequencing tuned to your race distance and terrain.</p>
            </article>
            <article>
              <h4 data-i18n="planning.weeklyStructure">Weekly structure</h4>
              <p data-i18n="planning.weeklyStructureDesc">Long runs, intensity, and recovery days aligned to your travel and workload constraints.</p>
            </article>
            <article>
              <h4 data-i18n="planning.adjustments">Explainable adjustments</h4>
              <p data-i18n="planning.adjustmentsDesc">Every change is tied to fatigue, consistency, and execution feedback.</p>
            </article>
          </div>
          <form class="plan-form" aria-label="Generate training plan">
            <h3 data-i18n="planning.quickPlan">Quick plan builder</h3>
            <label>
              <span data-i18n="planning.goalRace">Goal race</span>
              <input type="text" name="race" data-i18n="ph.goalRace" data-i18n-attr="placeholder" placeholder="Trail 50K" required />
            </label>
            <label>
              <span data-i18n="planning.raceDate">Race date</span>
              <input type="date" name="date" required />
            </label>
            <label>
              <span data-i18n="planning.weeklyAvailability">Weekly availability</span>
              <select name="availability">
                <option value="5">5 days</option>
                <option value="6">6 days</option>
                <option value="7">7 days</option>
              </select>
            </label>
            <label>
              <span data-i18n="planning.currentMileage">Current weekly mileage</span>
              <input type="number" name="mileage" min="10" max="120" value="40" />
            </label>
            <label>
              <span data-i18n="planning.constraints">Key constraints</span>
              <textarea name="constraints" rows="3" data-i18n="ph.constraints" data-i18n-attr="placeholder" placeholder="Work travel in week 6, prefer long runs on Sundays"></textarea>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" name="b2b" />
              <span data-i18n="planning.b2b">Back-to-back long run weekends</span>
            </label>
            <button class="cta" type="submit" data-i18n="planning.createDraft">Create draft plan</button>
            <p class="form-note" role="status" aria-live="polite"></p>
          </form>
        </div>
        <div class="my-plans" id="my-plans" hidden>
          <h3 data-i18n="planning.myPlans">My plans</h3>
          <div class="plans-list" id="plans-list"></div>
        </div>
        <div id="block-calendar" class="block-calendar" hidden>
          <h3 data-i18n="planning.trainingBlocks">Training blocks</h3>
          <div id="block-timeline" class="block-timeline"></div>
          <div id="block-details" class="block-details"></div>
        </div>
        <div id="gantt-planner" class="gantt-planner" hidden>
          <h3 data-i18n="gantt.title">Training block planner</h3>
          <p class="muted" data-i18n="gantt.subtitle">Koop periodization &mdash; week-by-week breakdown</p>
          <div id="gantt-phase-bar" class="gantt-phase-bar"></div>
          <div id="gantt-volume-chart" class="gantt-volume-chart"></div>
          <div class="gantt-scroll">
            <table class="gantt-table" id="gantt-table">
              <thead>
                <tr>
                  <th data-i18n="gantt.week">Wk</th>
                  <th data-i18n="gantt.date">Date</th>
                  <th data-i18n="gantt.phase">Phase</th>
                  <th data-i18n="gantt.volume">Volume</th>
                  <th data-i18n="gantt.keySession">Key session</th>
                  <th data-i18n="gantt.longRun">Long run</th>
                  <th data-i18n="gantt.notes">Notes</th>
                </tr>
              </thead>
              <tbody id="gantt-body"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Insights section -->
      <section id="insights" class="page">
        <div class="page-header">
          <h2 data-i18n="insights.title">Training analysis &amp; insights</h2>
          <p data-i18n="insights.desc">Understand readiness, spot risk early, and see the impact of your consistency.</p>
        </div>
        <div class="insight-cards">
          <div class="insight">
            <span class="pill" data-i18n="insights.trainingLoad">Training load</span>
            <h4 data-i18n="insights.acuteVsChronic">Acute vs chronic balance</h4>
            <p data-i18n="insights.acuteDesc">Visualize fatigue and form trends so you can confidently push or recover.</p>
          </div>
          <div class="insight">
            <span class="pill" data-i18n="insights.performance">Performance</span>
            <h4 data-i18n="insights.raceForecast">Race readiness forecast</h4>
            <p data-i18n="insights.raceDesc">Track long-run durability, vertical progression, and race-specific confidence signals.</p>
          </div>
          <div class="insight">
            <span class="pill" data-i18n="insights.risk">Risk</span>
            <h4 data-i18n="insights.overtraining">Overtraining alerts</h4>
            <p data-i18n="insights.overtrainingDesc">Detect sudden spikes and missed recovery before they derail the block.</p>
          </div>
        </div>

        <div id="training-load-section" hidden>
          <h4 data-i18n="insights.loadTrend">Training load trend</h4>
          <div id="training-load-chart" class="chart-container"></div>
        </div>

        <div id="long-run-section" hidden>
          <h4 data-i18n="insights.longRunProg">Long run progression</h4>
          <div id="long-run-chart" class="chart-container"></div>
        </div>

        <div class="insight-summary" id="insight-summary">
          <div>
            <h4 data-i18n="insights.latestCheckin">Latest check-in</h4>
            <p class="muted" id="latest-checkin-text" data-i18n="insights.noCheckin">
              No check-in yet. Submit your weekly check-in below to track readiness.
            </p>
          </div>
          <div class="stats" id="insight-stats">
            <div>
              <span class="label" data-i18n="insights.formTrend">Form trend</span>
              <strong id="stat-form">&mdash;</strong>
            </div>
            <div>
              <span class="label" data-i18n="insights.readiness">Readiness</span>
              <strong id="stat-readiness">&mdash;</strong>
            </div>
            <div>
              <span class="label" data-i18n="insights.riskScore">Risk score</span>
              <strong id="stat-risk">&mdash;</strong>
            </div>
          </div>
        </div>

        <div id="checkin-section" hidden>
          <h4 data-i18n="insights.weeklyCheckin">Weekly check-in</h4>
          <form id="checkin-form" class="checkin-form">
            <label>
              <span data-i18n="insights.fatigue">Fatigue</span> <output class="range-val">3</output>/5
              <input type="range" name="fatigue" min="1" max="5" value="3" />
            </label>
            <label>
              <span data-i18n="insights.sleepQuality">Sleep quality</span> <output class="range-val">3</output>/5
              <input type="range" name="sleep_quality" min="1" max="5" value="3" />
            </label>
            <label>
              <span data-i18n="insights.motivation">Motivation</span> <output class="range-val">3</output>/5
              <input type="range" name="motivation" min="1" max="5" value="3" />
            </label>
            <label>
              <span data-i18n="insights.niggles">Any niggles or pain?</span>
              <input type="text" name="niggles" data-i18n="ph.niggles" data-i18n-attr="placeholder" placeholder="e.g. left achilles tightness" />
            </label>
            <label>
              <span data-i18n="insights.notes">Notes</span>
              <textarea name="notes" rows="2" data-i18n="ph.notes" data-i18n-attr="placeholder" placeholder="How was your week?"></textarea>
            </label>
            <button class="cta" type="submit" data-i18n="insights.submitCheckin">Submit check-in</button>
            <p class="checkin-note" role="status" aria-live="polite"></p>
          </form>
          <div id="checkin-history" class="checkin-history"></div>
        </div>
      </section>

      <!-- Data section -->
      <section id="data" class="page">
        <div class="page-header">
          <h2 data-i18n="data.title">Reliable data ingestion</h2>
          <p data-i18n="data.desc">Sync Strava automatically, log workouts manually, and normalize everything for analytics.</p>
        </div>
        <div class="data-panel">
          <div>
            <h4 data-i18n="data.connectedSources">Connected sources</h4>
            <ul>
              <li data-i18n="data.stravaSync">Strava activity sync</li>
              <li data-i18n="data.manualEntry">Manual run + cross-training entry</li>
              <li data-i18n="data.hrSupport">Heart-rate &amp; elevation support</li>
            </ul>
          </div>
          <div>
            <h4 data-i18n="data.privacyStorage">Privacy-first storage</h4>
            <p data-i18n="data.privacyDesc">Supabase-backed, athlete-owned data with row-level security.</p>
            <button class="ghost" data-action="policy" data-i18n="data.reviewPolicy">Review data policy</button>
          </div>
          <div id="strava-panel">
            <h4 data-i18n="data.strava">Strava</h4>
            <div id="strava-disconnected">
              <p class="muted" data-i18n="data.stravaConnect">Connect your Strava account to import training data.</p>
              <button class="cta" id="strava-connect-btn" data-i18n="data.connectStrava">Connect Strava</button>
            </div>
            <div id="strava-connected" hidden>
              <div class="sync-list">
                <div>
                  <span class="label" data-i18n="data.status">Status</span>
                  <strong class="positive" data-i18n="data.connected">Connected</strong>
                </div>
                <div>
                  <span class="label" data-i18n="data.lastSync">Last sync</span>
                  <strong id="last-sync-time" data-i18n="data.never">Never</strong>
                </div>
              </div>
              <div class="strava-actions">
                <button class="cta" id="strava-sync-btn" data-i18n="data.syncNow">Sync now</button>
                <button class="ghost" id="strava-disconnect-btn" data-i18n="data.disconnect">Disconnect</button>
              </div>
            </div>
          </div>
        </div>

        <div id="weekly-dashboard" hidden>
          <h3 data-i18n="data.thisWeek">This week</h3>
          <div id="current-week-summary" class="week-summary-grid"></div>
          <h4 data-i18n="data.recentWeeks">Recent weeks</h4>
          <div id="weekly-history" class="weekly-history"></div>
        </div>

        <div id="manual-entry-section" hidden>
          <h3 data-i18n="data.logWorkout">Log a workout</h3>
          <form id="manual-entry-form" class="manual-form">
            <label>
              <span data-i18n="data.activityName">Activity name</span>
              <input type="text" name="name" data-i18n="ph.activityName" data-i18n-attr="placeholder" placeholder="Morning trail run" required />
            </label>
            <label>
              <span data-i18n="data.type">Type</span>
              <select name="type">
                <option value="Run" data-i18n="type.Run">Run</option>
                <option value="Hike" data-i18n="type.Hike">Hike</option>
                <option value="Walk" data-i18n="type.Walk">Walk</option>
                <option value="Strength" data-i18n="type.Strength">Strength</option>
                <option value="Yoga" data-i18n="type.Yoga">Yoga</option>
                <option value="Cross-training" data-i18n="type.Cross-training">Cross-training</option>
              </select>
            </label>
            <div class="form-row">
              <label>
                <span data-i18n="data.distance">Distance (mi)</span>
                <input type="number" name="distance" min="0" step="0.1" />
              </label>
              <label>
                <span data-i18n="data.duration">Duration (min)</span>
                <input type="number" name="duration" min="0" />
              </label>
              <label>
                <span data-i18n="data.elevation">Elevation (ft)</span>
                <input type="number" name="elevation" min="0" />
              </label>
            </div>
            <label>
              <span data-i18n="data.date">Date</span>
              <input type="date" name="date" required />
            </label>
            <label>
              <span data-i18n="data.effort">Effort (RPE)</span> <output class="range-val">5</output>/10
              <input type="range" name="effort" min="1" max="10" value="5" />
            </label>
            <button class="cta" type="submit" data-i18n="data.saveWorkout">Save workout</button>
            <p class="manual-note" role="status" aria-live="polite"></p>
          </form>
        </div>

        <div id="activities-section" hidden>
          <h3 data-i18n="data.recentActivities">Recent activities</h3>
          <div class="activities-list" id="activities-list"></div>
        </div>
      </section>

      <!-- Coach section -->
      <section id="coach" class="page">
        <div class="page-header">
          <h2 data-i18n="coach.title">AI Coach</h2>
          <p data-i18n="coach.subtitle">Personalized coaching insights based on your training data</p>
        </div>
        <div id="coach-insights" class="coach-insights">
          <div class="coach-empty">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v1a7 7 0 0 1-14 0v-1"/><line x1="12" y1="18" x2="12" y2="22"/></svg>
            <p data-i18n="coach.noData">Connect Strava or log workouts to receive coaching insights.</p>
          </div>
        </div>
      </section>

      <!-- Roadmap section -->
      <section id="roadmap" class="page">
        <div class="page-header">
          <h2 data-i18n="roadmap.title">Roadmap for future expansion</h2>
          <p data-i18n="roadmap.desc">Designed for single-athlete focus today, ready for collaborative coaching tomorrow.</p>
        </div>
        <div class="timeline">
          <div>
            <h4 data-i18n="roadmap.now">Now</h4>
            <p data-i18n="roadmap.nowDesc">Personal training optimization with explainable AI guidance.</p>
          </div>
          <div>
            <h4 data-i18n="roadmap.next">Next</h4>
            <p data-i18n="roadmap.nextDesc">Coach-athlete sharing, injury prediction, and recovery integrations.</p>
          </div>
          <div>
            <h4 data-i18n="roadmap.later">Later</h4>
            <p data-i18n="roadmap.laterDesc">Nutrition insights, sleep data, and smarter route intelligence.</p>
          </div>
        </div>
      </section>

      <footer class="footer">
        <div>
          <strong>RunSmart</strong>
          <p data-i18n="footer.tagline">Evidence-informed training guidance for endurance runners.</p>
        </div>
        <div class="footer-links">
          <span data-i18n="footer.support">Support</span>
          <span data-i18n="footer.privacy">Privacy</span>
          <span data-i18n="footer.contact">Contact</span>
        </div>
      </footer>
    </div>

    <!-- Auth modal -->
    <div class="modal-overlay" id="auth-modal" hidden>
      <div class="modal">
        <button class="modal-close" aria-label="Close">&times;</button>
        <h3 class="modal-title" data-i18n="auth.title">Sign in to RunSmart</h3>
        <button class="google-btn" id="google-signin-btn">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          <span data-i18n="auth.googleContinue">Continue with Google</span>
        </button>
        <div class="auth-divider"><span data-i18n="auth.or">or</span></div>
        <div class="modal-tabs">
          <button class="modal-tab active" data-tab="signin" data-i18n="auth.emailSignin">Email sign in</button>
          <button class="modal-tab" data-tab="signup" data-i18n="auth.signup">Sign up</button>
        </div>
        <form class="auth-form" id="auth-form">
          <label>
            <span data-i18n="auth.email">Email</span>
            <input type="email" name="email" required />
          </label>
          <label>
            <span data-i18n="auth.password">Password</span>
            <input type="password" name="password" minlength="6" required />
          </label>
          <button class="cta" type="submit" data-i18n="auth.signinBtn">Sign in</button>
          <p class="auth-error" role="alert" aria-live="polite"></p>
        </form>
      </div>
    </div>

    <script src="lang.js"></script>
    <script src="compute.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
  </body>
</html>
